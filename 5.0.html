<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moja R√≥≈ºowa Faktura</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ffe6f2, #ffd1e8);
            min-height: 100vh;
            padding: 20px;
            color: #8a2d61;
        }

        .faktura-box {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(214, 51, 132, 0.2);
            border: 3px solid #ffb6d9;
            overflow: hidden;
        }

        .naglowek {
            background: linear-gradient(135deg, #e83e8c, #d63384);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .naglowek h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .przyciski {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding: 20px;
            background: #fff0f7;
        }

        .przycisk {
            padding: 12px 25px;
            background: #e83e8c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .przycisk:hover {
            background: #d63384;
            transform: translateY(-2px);
        }

        .dane-faktury {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
            background: #fffafc;
        }

        .sekcja {
            background: #fff0f7;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ffd1e8;
        }

        .sekcja h3 {
            color: #d63384;
            margin-bottom: 15px;
            border-bottom: 2px solid #ffb6d9;
            padding-bottom: 5px;
        }

        .grupa-input {
            margin-bottom: 15px;
        }

        .grupa-input label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #a83773;
        }

        .grupa-input input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ffb6d9;
            border-radius: 6px;
            font-size: 16px;
            background: white;
        }

        .tabela-uslug {
            padding: 0 30px 30px;
        }

        .naglowek-tabeli {
            display: grid;
            grid-template-columns: 60px 1fr 120px 100px 120px 100px;
            gap: 15px;
            padding: 15px;
            background: #ffd1e8;
            font-weight: bold;
            border-radius: 8px 8px 0 0;
        }

        .wiersz-uslugi {
            display: grid;
            grid-template-columns: 60px 1fr 120px 100px 120px 100px;
            gap: 15px;
            padding: 12px 15px;
            border-bottom: 1px solid #ffd1e8;
            align-items: center;
        }

        .wiersz-dodawania {
            display: grid;
            grid-template-columns: 60px 1fr 120px 100px 120px 100px;
            gap: 15px;
            padding: 15px;
            background: #fffafc;
            border-radius: 0 0 8px 8px;
        }

        .wiersz-dodawania input {
            padding: 8px;
            border: 2px solid #ffb6d9;
            border-radius: 6px;
            background: white;
        }

        .przycisk-dodaj {
            background: #e83e8c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .przycisk-usun {
            background: #c22574;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
        }

        .suma-calkowita {
            text-align: right;
            padding: 20px 30px;
            font-size: 20px;
            font-weight: bold;
            background: #fff0f7;
            border-top: 3px solid #ffb6d9;
        }

        .kwota-suma {
            color: #d63384;
            font-size: 24px;
        }

        .ukryty-input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="faktura-box">
        <div class="naglowek">
            <h1>ü©∑ MOJA FAKTURA ü©∑</h1>
            <p>System zarzƒÖdzania fakturami</p>
        </div>

        <div class="przyciski">
            <button class="przycisk" id="przyciskWczytaj">Wczytaj z XML</button>
            <button class="przycisk" id="przyciskZapisz">Zapisz do XML</button>
        </div>

        <input type="file" id="inputPlik" class="ukryty-input" accept=".xml">

        <div class="dane-faktury">
            <div class="sekcja">
                <h3> Dane Faktury</h3>
                <div class="grupa-input">
                    <label for="numerFaktury">Numer faktury:</label>
                    <input type="text" id="numerFaktury" placeholder="FV/2024/001">
                </div>
                <div class="grupa-input">
                    <label for="dataWystawienia">Data wystawienia:</label>
                    <input type="date" id="dataWystawienia">
                </div>
                <div class="grupa-input">
                    <label for="dataSprzedazy">Data sprzeda≈ºy:</label>
                    <input type="date" id="dataSprzedazy">
                </div>
            </div>

            <div class="sekcja">
                <h3> Dane Klienta</h3>
                <div class="grupa-input">
                    <label for="nazwaKlienta">Nazwa klienta:</label>
                    <input type="text" id="nazwaKlienta" placeholder="Imiƒô i nazwisko lub firma">
                </div>
                <div class="grupa-input">
                    <label for="adresKlienta">Adres klienta:</label>
                    <input type="text" id="adresKlienta" placeholder="Ulica, kod pocztowy, miasto">
                </div>
                <div class="grupa-input">
                    <label for="nipKlienta">NIP klienta:</label>
                    <input type="text" id="nipKlienta" placeholder="1234567890">
                </div>
            </div>

            <div class="sekcja">
                <h3> Dane Sprzedawcy</h3>
                <div class="grupa-input">
                    <label for="nazwaSprzedawcy">Nazwa sprzedawcy:</label>
                    <input type="text" id="nazwaSprzedawcy" placeholder="Nazwa firmy">
                </div>
                <div class="grupa-input">
                    <label for="adresSprzedawcy">Adres sprzedawcy:</label>
                    <input type="text" id="adresSprzedawcy" placeholder="Ulica, kod pocztowy, miasto">
                </div>
                <div class="grupa-input">
                    <label for="nipSprzedawcy">NIP sprzedawcy:</label>
                    <input type="text" id="nipSprzedawcy" placeholder="0987654321">
                </div>
            </div>
        </div>

        <div class="tabela-uslug">
            <div class="naglowek-tabeli">
                <div>Lp.</div>
                <div>Nazwa us≈Çugi</div>
                <div>Cena (PLN)</div>
                <div>Ilo≈õƒá</div>
                <div>Warto≈õƒá (PLN)</div>
                <div>Akcje</div>
            </div>

            <div id="listaUslug"></div>

            <div class="wiersz-dodawania">
                <div></div>
                <input type="text" id="nazwaNowejUslugi" placeholder="Wpisz nazwƒô us≈Çugi">
                <input type="number" id="cenaNowejUslugi" placeholder="0.00" min="0" step="0.01">
                <input type="number" id="iloscNowejUslugi" placeholder="1" min="1">
                <input type="text" id="wartoscNowejUslugi" placeholder="0.00" readonly>
                <button class="przycisk-dodaj" id="przyciskDodajUsluge">‚ûï Dodaj</button>
            </div>
        </div>

        <div class="suma-calkowita">
            Suma ca≈Çkowita: <span class="kwota-suma" id="sumaCalkowita">0.00</span> PLN
        </div>
    </div>

    <script>
        let numerKolejny = 1;
        const listaUslug = document.getElementById('listaUslug');
        const przyciskDodajUsluge = document.getElementById('przyciskDodajUsluge');
        const nazwaNowejUslugi = document.getElementById('nazwaNowejUslugi');
        const cenaNowejUslugi = document.getElementById('cenaNowejUslugi');
        const iloscNowejUslugi = document.getElementById('iloscNowejUslugi');
        const wartoscNowejUslugi = document.getElementById('wartoscNowejUslugi');
        const sumaCalkowita = document.getElementById('sumaCalkowita');
        const przyciskWczytaj = document.getElementById('przyciskWczytaj');
        const przyciskZapisz = document.getElementById('przyciskZapisz');
        const inputPlik = document.getElementById('inputPlik');


        function obliczWartosc() {
            const cena = parseFloat(cenaNowejUslugi.value) || 0;
            const ilosc = parseInt(iloscNowejUslugi.value) || 0;
            const wartosc = (cena * ilosc).toFixed(2);
            wartoscNowejUslugi.value = wartosc;
        }

        function dodajUsluge() {
            const nazwa = nazwaNowejUslugi.value.trim();
            const cena = parseFloat(cenaNowejUslugi.value);
            const ilosc = parseInt(iloscNowejUslugi.value);
            const wartosc = parseFloat(wartoscNowejUslugi.value);

            if (nazwa && cena > 0 && ilosc > 0) {
                // Tworzy nowy wiersz
                const nowyWiersz = document.createElement('div');
                nowyWiersz.className = 'wiersz-uslugi';
                nowyWiersz.innerHTML = `
                    <div>${numerKolejny}.</div>
                    <div>${nazwa}</div>
                    <div>${cena.toFixed(2)}</div>
                    <div>${ilosc}</div>
                    <div>${wartosc.toFixed(2)}</div>
                    <button class="przycisk-usun">üóëÔ∏è Usu≈Ñ</button>
                `;

                listaUslug.appendChild(nowyWiersz);
                numerKolejny++;

                nazwaNowejUslugi.value = '';
                cenaNowejUslugi.value = '';
                iloscNowejUslugi.value = '';
                wartoscNowejUslugi.value = '0.00';

                obliczSumeCalkowita();

                nowyWiersz.querySelector('.przycisk-usun').addEventListener('click', function() {
                    nowyWiersz.remove();
                    poprawNumery();
                    obliczSumeCalkowita();
                });

            } else {
                alert(' Proszƒô wype≈Çniƒá wszystkie pola poprawnie!');
            }
        }

        function poprawNumery() {
            const wiersze = listaUslug.querySelectorAll('.wiersz-uslugi');
            numerKolejny = 1;
            wiersze.forEach(wiersz => {
                wiersz.querySelector('div:first-child').textContent = numerKolejny + '.';
                numerKolejny++;
            });
        }

        function obliczSumeCalkowita() {
            const wiersze = listaUslug.querySelectorAll('.wiersz-uslugi');
            let suma = 0;

            wiersze.forEach(wiersz => {
                const kwota = parseFloat(wiersz.querySelector('div:nth-child(5)').textContent);
                suma += kwota;
            });

            sumaCalkowita.textContent = suma.toFixed(2);
        }

        function stworzXML() {
            let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
            xml += '<faktura>\n';

            xml += '  <daneFaktury>\n';
            xml += `    <numer>${document.getElementById('numerFaktury').value || ''}</numer>\n`;
            xml += `    <dataWystawienia>${document.getElementById('dataWystawienia').value || ''}</dataWystawienia>\n`;
            xml += `    <dataSprzedazy>${document.getElementById('dataSprzedazy').value || ''}</dataSprzedazy>\n`;
            xml += '  </daneFaktury>\n';

            xml += '  <sprzedawca>\n';
            xml += `    <nazwa>${document.getElementById('nazwaSprzedawcy').value || ''}</nazwa>\n`;
            xml += `    <adres>${document.getElementById('adresSprzedawcy').value || ''}</adres>\n`;
            xml += `    <nip>${document.getElementById('nipSprzedawcy').value || ''}</nip>\n`;
            xml += '  </sprzedawca>\n';

            xml += '  <klient>\n';
            xml += `    <nazwa>${document.getElementById('nazwaKlienta').value || ''}</nazwa>\n`;
            xml += `    <adres>${document.getElementById('adresKlienta').value || ''}</adres>\n`;
            xml += `    <nip>${document.getElementById('nipKlienta').value || ''}</nip>\n`;
            xml += '  </klient>\n';

            xml += '  <uslugi>\n';
            const wiersze = listaUslug.querySelectorAll('.wiersz-uslugi');
            wiersze.forEach(wiersz => {
                xml += '    <usluga>\n';
                xml += `      <nazwa>${wiersz.querySelector('div:nth-child(2)').textContent}</nazwa>\n`;
                xml += `      <cena>${wiersz.querySelector('div:nth-child(3)').textContent}</cena>\n`;
                xml += `      <ilosc>${wiersz.querySelector('div:nth-child(4)').textContent}</ilosc>\n`;
                xml += `      <wartosc>${wiersz.querySelector('div:nth-child(5)').textContent}</wartosc>\n`;
                xml += '    </usluga>\n';
            });
            xml += '  </uslugi>\n';

            xml += '</faktura>';
            return xml;
        }

        function zapiszDoXML() {
            const zawartoscXML = stworzXML();
            const blob = new Blob([zawartoscXML], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'moja_faktura.xml';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(' Faktura zosta≈Ça zapisana!');
        }

        function wczytajZXML(plik) {
            const czytnik = new FileReader();
            
            czytnik.onload = function(zdarzenie) {
                try {
                    const parser = new DOMParser();
                    const xmlDokument = parser.parseFromString(zdarzenie.target.result, 'application/xml');

                    document.getElementById('numerFaktury').value = 
                        xmlDokument.querySelector('numer')?.textContent || '';
                    document.getElementById('dataWystawienia').value = 
                        xmlDokument.querySelector('dataWystawienia')?.textContent || '';
                    document.getElementById('dataSprzedazy').value = 
                        xmlDokument.querySelector('dataSprzedazy')?.textContent || '';

                    document.getElementById('nazwaSprzedawcy').value = 
                        xmlDokument.querySelector('sprzedawca > nazwa')?.textContent || '';
                    document.getElementById('adresSprzedawcy').value = 
                        xmlDokument.querySelector('sprzedawca > adres')?.textContent || '';
                    document.getElementById('nipSprzedawcy').value = 
                        xmlDokument.querySelector('sprzedawca > nip')?.textContent || '';

                    document.getElementById('nazwaKlienta').value = 
                        xmlDokument.querySelector('klient > nazwa')?.textContent || '';
                    document.getElementById('adresKlienta').value = 
                        xmlDokument.querySelector('klient > adres')?.textContent || '';
                    document.getElementById('nipKlienta').value = 
                        xmlDokument.querySelector('klient > nip')?.textContent || '';

                    listaUslug.innerHTML = '';
                    numerKolejny = 1;

                    const uslugi = xmlDokument.querySelectorAll('usluga');
                    
                    uslugi.forEach(usluga => {
                        const nazwa = usluga.querySelector('nazwa')?.textContent || 'Brak nazwy';
                        const cena = parseFloat(usluga.querySelector('cena')?.textContent) || 0;
                        const ilosc = parseInt(usluga.querySelector('ilosc')?.textContent) || 0;
                        const wartosc = parseFloat(usluga.querySelector('wartosc')?.textContent) || 0;

                        const nowyWiersz = document.createElement('div');
                        nowyWiersz.className = 'wiersz-uslugi';
                        nowyWiersz.innerHTML = `
                            <div>${numerKolejny}.</div>
                            <div>${nazwa}</div>
                            <div>${cena.toFixed(2)}</div>
                            <div>${ilosc}</div>
                            <div>${wartosc.toFixed(2)}</div>
                            <button class="przycisk-usun">üóëÔ∏è Usu≈Ñ</button>
                        `;

                        listaUslug.appendChild(nowyWiersz);
                        numerKolejny++;

                        nowyWiersz.querySelector('.przycisk-usun').addEventListener('click', function() {
                            nowyWiersz.remove();
                            poprawNumery();
                            obliczSumeCalkowita();
                        });
                    });

                    obliczSumeCalkowita();
                    alert(` Faktura wczytana! Za≈Çadowano ${uslugi.length} us≈Çug.`);

                } catch (blad) {
                    console.error('B≈ÇƒÖd:', blad);
                    alert(' B≈ÇƒÖd podczas wczytywania pliku XML!');
                }
            };

            czytnik.readAsText(plik);
        }


        cenaNowejUslugi.addEventListener('input', obliczWartosc);
        iloscNowejUslugi.addEventListener('input', obliczWartosc);

        przyciskDodajUsluge.addEventListener('click', dodajUsluge);

        przyciskWczytaj.addEventListener('click', function() {
            inputPlik.click();
        });

        inputPlik.addEventListener('change', function(zdarzenie) {
            if (zdarzenie.target.files.length > 0) {
                wczytajZXML(zdarzenie.target.files[0]);
            }
        });

        przyciskZapisz.addEventListener('click', zapiszDoXML);

        obliczWartosc();
    </script>
</body>
</html>
